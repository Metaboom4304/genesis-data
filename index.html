<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>GENESIS WAR MAP</title>
  <base href="https://metaboom4304.github.io/genesis-data/">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"
  />
  <style>
    /* ... ваши стили для карты и панели ... */
  </style>
</head>
<body>
  <div id="map" style="position:absolute;top:0;bottom:0;left:0;right:0"></div>

  <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
  <script>
  (async ()=>{
    // вычисляем базовый путь к data/
    const repo = location.pathname.split('/')[1] || '';
    const BASE = location.hostname.includes('github.io')
      ? `${location.origin}/${repo}/data/`
      : './data/';
    console.log('BASE:', BASE);

    // собираем список JSON-файлов
    const PARTS = Array.from({length:22}, (_,i)=>
      `${BASE}tiles_${String(i+1).padStart(2,'0')}.json`
    );
    console.log('PARTS:', PARTS);

    // загружаем их подряд
    let tileData = [];
    for (const url of PARTS) {
      console.log('fetching', url);
      const res = await fetch(url);
      if (!res.ok) throw new Error(`Ошибка ${res.status} при загрузке ${url}`);
      const part = await res.json();
      tileData.push(...part);
    }
    console.log('Loaded tiles count:', tileData.length);

    // инициализируем карту
    const map = L.map('map', { center:[49.25,-123.10], zoom:4, attributionControl:false });
    L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png')
      .addTo(map);

    // простой рендер: один прямоугольник для проверки
    const t = tileData[0];
    const degLat = 170/256, degLng = 360/256;
    const bounds = [
      [t.lat - degLat/2, t.lng - degLng/2],
      [t.lat + degLat/2, t.lng + degLng/2]
    ];
    L.rectangle(bounds, { color:'#ff0', weight:2 }).addTo(map);
    map.fitBounds(bounds);

  })().catch(e=>{
    console.error(e);
    alert('Ошибка: '+e.message);
  });
  </script>
</body>
</html>
